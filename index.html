<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nolikby - Каталог Акций</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .offer-card {
            display: flex;
            flex-direction: column;
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .offer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .offer-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background-color: #e2e8f0;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 0.5rem 0;
            color: #6b7280;
            font-size: 0.75rem;
            text-decoration: none;
            transition: color 0.2s ease-in-out;
        }
        .nav-item.active {
            color: #3b82f6;
        }
        .nav-item:hover {
            color: #3b82f6;
        }
        .category-item {
            cursor: pointer;
        }
        .category-item.active {
            outline: 2px solid #3b82f6;
            outline-offset: 4px;
        }
    </style>
</head>
<body class="bg-blue-50">

    <div id="app" class="min-h-screen pb-20">
        <!-- Шапка -->
        <header id="main-header" class="bg-white text-gray-800 p-4 shadow-md sticky top-0 z-10">
            <div class="container mx-auto flex items-center justify-between">
                <button class="text-blue-500 p-2 rounded-full hover:bg-gray-100 transition-colors focus:outline-none">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
                <!-- Обновленный блок для выбора города -->
                <div class="flex items-center justify-center text-lg font-bold text-gray-800 mx-4">
                    <span>Гомель</span>
                    <svg class="w-5 h-5 ml-2 text-gray-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </div>
                <!-- Ссылка на админ-панель -->
                <a href="admin.html" class="text-blue-500 p-2 rounded-full hover:bg-gray-100 transition-colors focus:outline-none" title="Панель администратора">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                </a>
            </div>
        </header>

        <main class="container mx-auto p-4 md:p-6">
            <!-- Выгодные предложения (Баннер) -->
            <section class="mb-8">
                <div id="hot-offers-carousel" class="bg-gradient-to-r from-purple-600 to-pink-500 rounded-2xl overflow-hidden shadow-xl md:h-56 h-40 relative flex items-center justify-center p-4 text-white text-center">
                    <h3 class="text-3xl font-bold">Скидка до 70% на всё!</h3>
                    <p class="text-lg mt-2">Эксклюзивно для наших пользователей</p>
                </div>
            </section>

            <!-- Поиск -->
            <section class="mb-8">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="Я ищу..." class="w-full py-3 px-5 pr-12 rounded-full text-gray-800 text-base shadow-inner focus:outline-none focus:ring-2 focus:ring-blue-300">
                    <svg class="h-6 w-6 absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </section>
            
            <!-- Категории -->
            <section id="categories-section" class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Категории</h2>
                <div id="categories-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <div class="flex flex-col items-center justify-center bg-white rounded-lg p-4 shadow-lg text-center transition-transform transform hover:scale-105 category-item" data-category="Все">
                        <img src="https://placehold.co/100x100/3b82f6/ffffff?text=Все" alt="Все" class="w-20 h-20 mb-2">
                        <span class="text-base font-medium text-gray-700">Все</span>
                    </div>
                    <div class="flex flex-col items-center justify-center bg-white rounded-lg p-4 shadow-lg text-center transition-transform transform hover:scale-105 category-item" data-category="Еда">
                        <img src="https://placehold.co/100x100/10b981/ffffff?text=Еда" alt="Еда" class="w-20 h-20 mb-2">
                        <span class="text-base font-medium text-gray-700">Еда</span>
                    </div>
                    <div class="flex flex-col items-center justify-center bg-white rounded-lg p-4 shadow-lg text-center transition-transform transform hover:scale-105 category-item" data-category="Одежда">
                        <img src="https://placehold.co/100x100/ef4444/ffffff?text=Одежда" alt="Одежда" class="w-20 h-20 mb-2">
                        <span class="text-base font-medium text-gray-700">Одежда</span>
                    </div>
                    <div class="flex flex-col items-center justify-center bg-white rounded-lg p-4 shadow-lg text-center transition-transform transform hover:scale-105 category-item" data-category="Электроника">
                        <img src="https://placehold.co/100x100/3b82f6/ffffff?text=Электроника" alt="Электроника" class="w-20 h-20 mb-2">
                        <span class="text-base font-medium text-gray-700">Электроника</span>
                    </div>
                    <div class="flex flex-col items-center justify-center bg-white rounded-lg p-4 shadow-lg text-center transition-transform transform hover:scale-105 category-item" data-category="Красота">
                        <img src="https://placehold.co/100x100/8b5cf6/ffffff?text=Красота" alt="Красота" class="w-20 h-20 mb-2">
                        <span class="text-base font-medium text-gray-700">Красота</span>
                    </div>
                    <div class="flex flex-col items-center justify-center bg-white rounded-lg p-4 shadow-lg text-center transition-transform transform hover:scale-105 category-item" data-category="Дом">
                        <img src="https://placehold.co/100x100/eab308/ffffff?text=Дом" alt="Дом" class="w-20 h-20 mb-2">
                        <span class="text-base font-medium text-gray-700">Дом</span>
                    </div>
                    <div class="flex flex-col items-center justify-center bg-white rounded-lg p-4 shadow-lg text-center transition-transform transform hover:scale-105 category-item" data-category="Развлечения">
                        <img src="https://placehold.co/100x100/ec4899/ffffff?text=Развлечения" alt="Развлечения" class="w-20 h-20 mb-2">
                        <span class="text-base font-medium text-gray-700">Развлечения</span>
                    </div>
                </div>
            </section>
            
            <!-- Все акции -->
            <section>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Все акции</h2>
                <div id="loading" class="text-center text-gray-500 font-semibold text-lg">Загрузка...</div>
                <div id="error" class="text-center text-red-500 font-semibold text-lg hidden">Ошибка при загрузке акций</div>
                <div id="offers-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                <div id="no-offers" class="text-center text-gray-500 font-semibold text-lg hidden">Акций пока нет.</div>
            </section>
        </main>

        <!-- Нижнее навигационное меню -->
        <nav class="fixed bottom-0 left-0 w-full bg-white shadow-2xl border-t border-gray-200 z-20">
            <div class="container mx-auto flex justify-around h-16">
                <a href="#" class="nav-item">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
                    <span>Главная</span>
                </a>
                <a href="#" id="categories-link" class="nav-item active">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
                    <span>Категории</span>
                </a>
                <a href="#" class="nav-item">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
                    <span>Мои Купоны</span>
                </a>
                <a href="#" class="nav-item">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
                    <span>Избранное</span>
                </a>
                <a href="#" class="nav-item">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
                    <span>Профиль</span>
                </a>
            </div>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // DOM elements
        const offersListElement = document.getElementById('offers-list');
        const loadingElement = document.getElementById('loading');
        const errorElement = document.getElementById('error');
        const noOffersElement = document.getElementById('no-offers');
        const categoriesList = document.getElementById('categories-list');
        const categories = document.querySelectorAll('.category-item');

        let allOffers = [];

        // Function to render offers based on a given list
        const renderOffers = (offers) => {
            offersListElement.innerHTML = '';
            if (offers.length === 0) {
                noOffersElement.classList.remove('hidden');
            } else {
                noOffersElement.classList.add('hidden');
                offers.forEach(offer => {
                    const offerElement = document.createElement('div');
                    offerElement.className = "offer-card";
                    offerElement.innerHTML = `
                        <img src="${offer.imageUrl}" alt="${offer.title}" class="offer-image">
                        <div class="p-5 flex-grow">
                            <h3 class="text-xl font-bold text-gray-900 mb-2">${offer.title}</h3>
                            <p class="text-sm text-gray-600 mb-2">${offer.description}</p>
                            <p class="text-sm text-gray-600 mb-1">Категория: <span class="font-medium text-gray-800">${offer.category}</span></p>
                            <p class="text-sm text-gray-600 mb-1">Город: <span class="font-medium text-gray-800">${offer.city}</span></p>
                            <div class="flex items-baseline justify-between mt-3">
                                <span class="text-2xl font-extrabold text-red-600">${offer.discount}%</span>
                                <span class="text-xl font-bold text-gray-800 ml-2">${offer.price} ₽</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-3">
                                Период: ${new Date(offer.start_date).toLocaleDateString()} — ${new Date(offer.end_date).toLocaleDateString()}
                            </p>
                        </div>
                    `;
                    offersListElement.appendChild(offerElement);
                });
            }
        };

        // Listen for real-time changes in the offers collection
        const offersCollectionRef = collection(db, `artifacts/${appId}/public/data/offers`);
        onSnapshot(offersCollectionRef, (snapshot) => {
            allOffers = [];
            if (snapshot.empty) {
                loadingElement.classList.add('hidden');
                noOffersElement.classList.remove('hidden');
                return;
            }

            loadingElement.classList.add('hidden');
            snapshot.forEach(doc => {
                allOffers.push(doc.data());
            });
            
            // Initially render all offers
            renderOffers(allOffers);
            offersListElement.classList.remove('hidden');

        }, (error) => {
            console.error("Ошибка при получении акций:", error);
            loadingElement.classList.add('hidden');
            errorElement.classList.remove('hidden');
        });

        // Add click event listeners to categories for filtering
        categories.forEach(categoryItem => {
            categoryItem.addEventListener('click', () => {
                const selectedCategory = categoryItem.dataset.category;

                // Remove active class from all categories
                categories.forEach(item => item.classList.remove('active'));

                // Add active class to the clicked category
                categoryItem.classList.add('active');

                // Filter offers based on the selected category
                if (selectedCategory === 'Все') {
                    renderOffers(allOffers);
                } else {
                    const filteredOffers = allOffers.filter(offer => offer.category === selectedCategory);
                    renderOffers(filteredOffers);
                }
            });
        });

        // categories link functionality
        document.addEventListener('DOMContentLoaded', () => {
            const categoriesLink = document.getElementById('categories-link');
            const categoriesSection = document.getElementById('categories-section');
            const header = document.getElementById('main-header');

            categoriesLink.addEventListener('click', (event) => {
                event.preventDefault();
                
                const headerHeight = header.offsetHeight;
                const scrollPosition = categoriesSection.offsetTop - headerHeight;

                window.scrollTo({
                    top: scrollPosition,
                    behavior: 'smooth'
                });
            });
            // Set "Все" as active by default on load
            document.querySelector('.category-item[data-category="Все"]').click();
        });
    </script>
</body>
</html>