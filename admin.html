<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Nolikby</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
    .form-container {
      max-width: 600px;
      margin: 2rem auto;
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                  0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    .input-field {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      border: 1px solid #d1d5db;
      margin-top: 0.25rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .input-field:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    .btn-primary {
      width: 100%;
      padding: 0.75rem 1rem;
      background-color: #3b82f6;
      color: #ffffff;
      border-radius: 0.75rem;
      font-weight: 600;
      transition: background-color 0.2s ease-in-out;
    }
    .btn-primary:hover {
      background-color: #2563eb;
    }
  </style>
</head>
<body class="bg-blue-50">
  <div class="form-container">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∞–∫—Ü–∏—é</h1>
    <form id="add-offer-form" class="space-y-4">
      <div>
        <label for="offer-title" class="block text-gray-700 font-medium">–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ü–∏–∏</label>
        <input type="text" id="offer-title" name="title" required class="input-field">
      </div>
      <div>
        <label for="offer-image" class="block text-gray-700 font-medium">URL —Ñ–æ—Ç–æ</label>
        <input type="url" id="offer-image" name="imageUrl" required class="input-field">
      </div>
      <div>
        <label for="offer-description" class="block text-gray-700 font-medium">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea id="offer-description" name="description" rows="4" required class="input-field"></textarea>
      </div>
      <div>
        <label for="offer-category" class="block text-gray-700 font-medium">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="offer-category" name="category" required class="input-field">
          <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
          <option value="–ï–¥–∞">–ï–¥–∞</option>
          <option value="–û–¥–µ–∂–¥–∞">–û–¥–µ–∂–¥–∞</option>
          <option value="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
          <option value="–ö—Ä–∞—Å–æ—Ç–∞">–ö—Ä–∞—Å–æ—Ç–∞</option>
          <option value="–î–æ–º">–î–æ–º</option>
          <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
        </select>
      </div>
      <div>
        <label for="offer-city" class="block text-gray-700 font-medium">–ì–æ—Ä–æ–¥</label>
        <select id="offer-city" name="city" required class="input-field">
          <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
          <option value="–ì–æ–º–µ–ª—å">–ì–æ–º–µ–ª—å</option>
          <option value="–ú–∏–Ω—Å–∫">–ú–∏–Ω—Å–∫</option>
          <option value="–ë—Ä–µ—Å—Ç">–ë—Ä–µ—Å—Ç</option>
        </select>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="offer-discount" class="block text-gray-700 font-medium">–°–∫–∏–¥–∫–∞ (%)</label>
          <input type="number" id="offer-discount" name="discount" required class="input-field">
        </div>
        <div>
          <label for="offer-price" class="block text-gray-700 font-medium">–¶–µ–Ω–∞ (‚ÇΩ)</label>
          <input type="number" id="offer-price" name="price" required class="input-field">
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="offer-start-date" class="block text-gray-700 font-medium">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
          <input type="date" id="offer-start-date" name="start_date" required class="input-field">
        </div>
        <div>
          <label for="offer-end-date" class="block text-gray-700 font-medium">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
          <input type="date" id="offer-end-date" name="end_date" required class="input-field">
        </div>
      </div>
      <div id="status-message" class="text-center font-medium mt-4"></div>
      <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ü–∏—é</button>
    </form>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const statusMessage = document.getElementById('status-message');
    const form = document.getElementById('add-offer-form');

    // üîë –ö–æ–Ω—Ñ–∏–≥ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBVKxZjiE3iVoUOSRJkQhjjA4qXQmf9Xn8",
      authDomain: "nolikby-ae0a3.firebaseapp.com",
      projectId: "nolikby-ae0a3",
      storageBucket: "nolikby-ae0a3.appspot.com",
      messagingSenderId: "77429404737",
      appId: "1:77429404737:web:2dc91ad36d1eb2437182c0"
    };

    // üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    async function authenticate() {
      try {
        await signInAnonymously(auth);
        console.log('‚úÖ Signed in anonymously.');
      } catch (error) {
        console.error("‚ùå Authentication error:", error);
        statusMessage.textContent = "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –í–∫–ª—é—á–∏ Anonymous auth –≤ Firebase Console.";
        statusMessage.className = 'text-red-500 font-medium mt-4';
      }
    }

    // üìå –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!auth.currentUser) {
        statusMessage.textContent = "–û—à–∏–±–∫–∞: –Ω–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.";
        statusMessage.className = 'text-red-500 font-medium mt-4';
        return;
      }

      statusMessage.textContent = "–°–æ—Ö—Ä–∞–Ω—è–µ–º...";
      statusMessage.className = 'text-blue-500 font-medium mt-4';

      const formData = new FormData(form);
      const newOffer = {
        title: formData.get('title'),
        imageUrl: formData.get('imageUrl'),
        description: formData.get('description'),
        category: formData.get('category'),
        city: formData.get('city'),
        discount: parseInt(formData.get('discount')),
        price: parseInt(formData.get('price')),
        start_date: new Date(formData.get('start_date')).toISOString(),
        end_date: new Date(formData.get('end_date')).toISOString(),
        createdAt: new Date().toISOString()
      };

      try {
        const offersCollectionRef = collection(db, "offers");
        await addDoc(offersCollectionRef, newOffer);

        statusMessage.textContent = "‚úÖ –ê–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!";
        statusMessage.className = 'text-green-500 font-medium mt-4';
        form.reset();
      } catch (error) {
        console.error("‚ùå Error adding document:", error);
        statusMessage.textContent = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–∫—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
        statusMessage.className = 'text-red-500 font-medium mt-4';
      }
    });

    authenticate();
  </script>
</body>
</html>
